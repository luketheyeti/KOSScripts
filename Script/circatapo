
///circularize script at apo

parameter direction.


///////////////
run counttoapo(20).

//set targetorb to (apoapsis * .95).
set targetorb to (apoapsis - 5000).

print "Apo is " + round(apoapsis).
print "Target peri is " + round(targetorb).

wait until eta:apoapsis < 15.
lock steering to heading(direction,0).
wait until eta:apoapsis < 5.
print "burning in 5".
wait 5.
lock throttle to 1.  //change back to .6 for gentle burns.




wait until periapsis >= targetorb.
lock throttle to 0.


run eccentricity.
=======
//circularizes at apo
//parameter TargetAlt.
parameter Direction.


//Math
//orbital velocity at current apo beight
set TargetOrbVel to ship:body:radius * sqrt(9.8/(ship:body:radius + apoapsis)).
//twr?
set DeltaA to maxthrust/mass.
//How fast you will be going when you reach your current apo
set ApoVelocity to sqrt(ship:body:mu * ((2/(ship:body:radius + apoapsis))-(1/ship:obt:semimajoraxis))).
//DV
set DeltaV to (TargetOrbVel - ApoVelocity).
//burn time in seconds
set BurnTime to DeltaV / DeltaA.

print "app: " + round(apoapsis).

//print "Target Orb Vel: " + round(TargetOrbVel).
//print "Current Vel: " + round(ship:velocity:orbit:mag).
print "Diff: " + round(TargetOrbVel - ship:velocity:orbit:mag).

print "DeltaA: " + round(DeltaA).
print "Velocity at apo: " + round(ApoVelocity).
print "DV: " + round(DeltaV).

print "Burn Time (s): " + round(BurnTime).

//wait 15.

//clearscreen.

/////////

declare TargetOrb to round(Ship:Apoapsis).
print "target orb: " + TargetOrb.
print "time to apo: " + round(eta:apoapsis).

lock steering to prograde.
//lock steering to Direction.
wait 3.
//wait until eta:apoapsis <= BurnTime.
until eta:apoapsis <= BurnTime{
 clearscreen.
 print "time until apo: " + round(eta:apoapsis).
 print "Burn Time (s): " + round(BurnTime).
 wait .1.
}


print "waiting until burn: " + round(eta:apoapsis - (BurnTime/2)).
//wait until eta:apoapsis <= (BurnTime / 2) + 3.
until eta:apoapsis <= (BurnTime / 2) + 3{
 clearscreen.
 print "time until apo: " + round(eta:apoapsis).
 print "Burn Time (s): " + round(BurnTime).
 wait .1.
}

lock steering to heading (Direction,0).
print "burning in 2".
wait 3.
lock throttle to 1.
print "burning".

//print "apo: " + round(ship:apoapsis).
//wait until periapsis >= (TargetOrb * .95).

until periapsis >= (TargetOrb * .99) or (apoapsis >= (TargetOrb * 105) and periapsis >= max(72000,(TargetOrb * .99))){
 //wait until periapsis >= 72000.
 //wait BurnTime.
 //lock throttle to 0.
 clearscreen.
 print "apo: " + round(ship:apoapsis).
 print "tapo: " + TargetOrb.
 print "peri: " + round(ship:periapsis).
 print "tperi: " + (TargetOrb * .99).
 wait .1.
}

lock throttle to 0.

clearscreen.

print "welcome to orbit".
